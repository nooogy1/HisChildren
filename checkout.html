<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Checkout | His Children</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <!-- Header -->
  <header class="site-header">
    <div class="header-inner">
      <div class="site-logo">
        <a href="index.html">His Children</a>
      </div>

      <nav class="main-nav" aria-label="Main navigation">
        <ul>
          <li><a href="collections/heirloom-wooden.html">Heirloom Wooden</a></li>
          <li><a href="collections/imagination-builders.html">Imagination Builders</a></li>
          <li><a href="collections/storybook-friends.html">Storybook Friends</a></li>
          <li><a href="collections/wonder-learn.html">Wonder & Learn</a></li>
        </ul>
      </nav>

      <div class="header-actions">
        <a href="cart.html" class="cart-link" aria-label="Shopping cart">
          Cart <span class="cart-count"></span>
        </a>
        <button class="mobile-menu-toggle" aria-label="Open menu" onclick="toggleMobileNav()">
          <span></span>
          <span></span>
          <span></span>
        </button>
      </div>
    </div>
  </header>

  <!-- Mobile Navigation -->
  <nav class="mobile-nav" id="mobileNav" aria-label="Mobile navigation">
    <button class="mobile-nav-close" aria-label="Close menu" onclick="toggleMobileNav()">&times;</button>
    <ul>
      <li><a href="collections/heirloom-wooden.html">Heirloom Wooden</a></li>
      <li><a href="collections/imagination-builders.html">Imagination Builders</a></li>
      <li><a href="collections/storybook-friends.html">Storybook Friends</a></li>
      <li><a href="collections/wonder-learn.html">Wonder & Learn</a></li>
      <li><a href="cart.html">Cart</a></li>
    </ul>
  </nav>

  <main>
    <!-- Page Header -->
    <div class="page-header">
      <h1>Checkout</h1>
    </div>

    <div class="container">
      <div class="checkout-layout">
        <form class="checkout-form" id="checkoutForm" onsubmit="handleCheckout(event)">
          <!-- Contact Information -->
          <div class="checkout-section">
            <h3>Contact Information</h3>
            <div class="form-group">
              <label for="email">Email Address</label>
              <input type="email" id="email" name="email" required placeholder="your@email.com">
            </div>
          </div>

          <!-- Shipping Address -->
          <div class="checkout-section">
            <h3>Shipping Address</h3>
            <div class="form-row">
              <div class="form-group">
                <label for="firstName">First Name</label>
                <input type="text" id="firstName" name="firstName" required>
              </div>
              <div class="form-group">
                <label for="lastName">Last Name</label>
                <input type="text" id="lastName" name="lastName" required>
              </div>
            </div>
            <div class="form-group">
              <label for="address">Street Address</label>
              <input type="text" id="address" name="address" required>
            </div>
            <div class="form-group">
              <label for="apartment">Apartment, suite, etc. (optional)</label>
              <input type="text" id="apartment" name="apartment">
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="city">City</label>
                <input type="text" id="city" name="city" required>
              </div>
              <div class="form-group">
                <label for="state">State</label>
                <select id="state" name="state" required>
                  <option value="">Select state</option>
                  <option value="AL">Alabama</option>
                  <option value="AK">Alaska</option>
                  <option value="AZ">Arizona</option>
                  <option value="AR">Arkansas</option>
                  <option value="CA">California</option>
                  <option value="CO">Colorado</option>
                  <option value="CT">Connecticut</option>
                  <option value="DE">Delaware</option>
                  <option value="FL">Florida</option>
                  <option value="GA">Georgia</option>
                  <option value="HI">Hawaii</option>
                  <option value="ID">Idaho</option>
                  <option value="IL">Illinois</option>
                  <option value="IN">Indiana</option>
                  <option value="IA">Iowa</option>
                  <option value="KS">Kansas</option>
                  <option value="KY">Kentucky</option>
                  <option value="LA">Louisiana</option>
                  <option value="ME">Maine</option>
                  <option value="MD">Maryland</option>
                  <option value="MA">Massachusetts</option>
                  <option value="MI">Michigan</option>
                  <option value="MN">Minnesota</option>
                  <option value="MS">Mississippi</option>
                  <option value="MO">Missouri</option>
                  <option value="MT">Montana</option>
                  <option value="NE">Nebraska</option>
                  <option value="NV">Nevada</option>
                  <option value="NH">New Hampshire</option>
                  <option value="NJ">New Jersey</option>
                  <option value="NM">New Mexico</option>
                  <option value="NY">New York</option>
                  <option value="NC">North Carolina</option>
                  <option value="ND">North Dakota</option>
                  <option value="OH">Ohio</option>
                  <option value="OK">Oklahoma</option>
                  <option value="OR">Oregon</option>
                  <option value="PA">Pennsylvania</option>
                  <option value="RI">Rhode Island</option>
                  <option value="SC">South Carolina</option>
                  <option value="SD">South Dakota</option>
                  <option value="TN">Tennessee</option>
                  <option value="TX">Texas</option>
                  <option value="UT">Utah</option>
                  <option value="VT">Vermont</option>
                  <option value="VA">Virginia</option>
                  <option value="WA">Washington</option>
                  <option value="WV">West Virginia</option>
                  <option value="WI">Wisconsin</option>
                  <option value="WY">Wyoming</option>
                </select>
              </div>
            </div>
            <div class="form-group" style="max-width: 200px;">
              <label for="zip">ZIP Code</label>
              <input type="text" id="zip" name="zip" required pattern="[0-9]{5}" maxlength="5">
            </div>
          </div>

          <!-- Shipping Method -->
          <div class="checkout-section">
            <h3>Shipping Method</h3>
            <div class="shipping-options">
              <label class="shipping-option">
                <input type="radio" name="shipping" value="standard" checked>
                <div class="shipping-option-info">
                  <span class="shipping-option-name">Standard Shipping</span>
                  <span class="shipping-option-time">5-7 business days</span>
                </div>
                <span class="shipping-option-price" id="standardShippingPrice">$8.95</span>
              </label>
              <label class="shipping-option">
                <input type="radio" name="shipping" value="express">
                <div class="shipping-option-info">
                  <span class="shipping-option-name">Express Shipping</span>
                  <span class="shipping-option-time">2-3 business days</span>
                </div>
                <span class="shipping-option-price">$14.95</span>
              </label>
            </div>
            <p style="font-size: var(--text-sm); color: var(--color-text-muted); margin-top: var(--space-md);">
              Free standard shipping on orders over $75
            </p>
          </div>

          <!-- Submit Button (Mobile) -->
          <button type="submit" class="btn btn--primary btn--full" style="margin-top: var(--space-lg);">
            Complete Order
          </button>
        </form>

        <!-- Order Summary -->
        <div class="order-summary">
          <h3>Order Summary</h3>
          <div class="order-items" id="orderItems">
            <!-- Items will be rendered here -->
          </div>
          <div class="cart-summary-row">
            <span>Subtotal</span>
            <span id="orderSubtotal">$0.00</span>
          </div>
          <div class="cart-summary-row">
            <span>Shipping</span>
            <span id="orderShipping">$0.00</span>
          </div>
          <div class="cart-summary-total">
            <span>Total</span>
            <span id="orderTotal">$0.00</span>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="site-footer">
    <div class="footer-inner">
      <div class="footer-logo">His Children</div>
      <p class="footer-tagline">
        Thoughtful toys for purposeful play. Crafted with intention, made to be treasured.
      </p>
      <nav class="footer-nav">
        <a href="collection.html">All Collections</a>
        <a href="collections/heirloom-wooden.html">Heirloom Wooden</a>
        <a href="collections/imagination-builders.html">Imagination Builders</a>
        <a href="collections/storybook-friends.html">Storybook Friends</a>
        <a href="collections/wonder-learn.html">Wonder & Learn</a>
      </nav>
      <p class="footer-copyright">&copy; 2024 His Children. All rights reserved.</p>
    </div>
  </footer>

  <script src="js/cart.js"></script>
  <script>
    function toggleMobileNav() {
      const nav = document.getElementById('mobileNav');
      nav.classList.toggle('is-open');
    }

    let currentShipping = 8.95;

    function renderOrderSummary() {
      const items = Cart.getItems();
      const orderItemsEl = document.getElementById('orderItems');

      if (items.length === 0) {
        window.location.href = 'cart.html';
        return;
      }

      orderItemsEl.innerHTML = items.map(item => `
        <div class="order-item">
          <div class="order-item-image img-placeholder">
            <svg viewBox="0 0 60 60" xmlns="http://www.w3.org/2000/svg">
              <rect width="60" height="60" fill="#E8E4DD"/>
              <rect x="15" y="25" width="10" height="15" fill="#D4CFC5"/>
              <rect x="25" y="20" width="10" height="20" fill="#B8AFA3"/>
              <rect x="35" y="15" width="10" height="25" fill="#D4CFC5"/>
            </svg>
          </div>
          <div class="order-item-info">
            <div class="order-item-name">${item.name}</div>
            <div class="order-item-quantity">Qty: ${item.quantity}</div>
          </div>
          <div class="order-item-price">${Cart.formatPrice(item.price * item.quantity)}</div>
        </div>
      `).join('');

      updateOrderTotals();
    }

    function updateOrderTotals() {
      const totals = Cart.getTotals();
      const shippingMethod = document.querySelector('input[name="shipping"]:checked').value;

      // Calculate shipping
      if (totals.subtotal >= 75) {
        currentShipping = shippingMethod === 'express' ? 14.95 : 0;
        document.getElementById('standardShippingPrice').textContent = 'Free';
      } else {
        currentShipping = shippingMethod === 'express' ? 14.95 : 8.95;
        document.getElementById('standardShippingPrice').textContent = '$8.95';
      }

      const total = totals.subtotal + currentShipping;

      document.getElementById('orderSubtotal').textContent = Cart.formatPrice(totals.subtotal);
      document.getElementById('orderShipping').textContent = currentShipping === 0 ? 'Free' : Cart.formatPrice(currentShipping);
      document.getElementById('orderTotal').textContent = Cart.formatPrice(total);
    }

    function handleCheckout(event) {
      event.preventDefault();

      // Save order before clearing cart
      Cart.saveOrder();

      // Clear the cart
      Cart.clear();

      // Redirect to success page
      window.location.href = 'success.html';
    }

    // Listen for shipping method changes
    document.querySelectorAll('input[name="shipping"]').forEach(radio => {
      radio.addEventListener('change', updateOrderTotals);
    });

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', renderOrderSummary);
  </script>
</body>
</html>
